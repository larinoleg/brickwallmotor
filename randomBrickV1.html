<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="index.css">

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Playfair+Display&display=swap" rel="stylesheet">
    </head>
    <body>
        <div class = 'title'>
            <h1 class = 'hTitle'>Стеностроительная фабрика</h1>
            <p class = 'pText'>Калькулятор: </p>
        </div>
            <div class="main">
                <form method="post" class="formClass">
                    <label>Ширина <input name="widthField" value="" class="widthField"></label> 
                    <label>Высота<input name="heightField" value="" class="heightField"></label>
                    <input type="submit" value="Стереть стену" class="сlearButton">
                  </form>
                  <div class = 'error'>

                  </div>
                </div>
            <canvas id="canvas" class="canvas" width="620" height="10000"></canvas>
            <div class = 'canvas'> 
                <script>
                    
                    const inputField = document.querySelector(".formClass");
                    const pErrorText = document.createElement("p");
                    pErrorText.classList.add(".pError");
                    const errorForm = document.querySelector(".error");
                    errorForm.prepend(pErrorText);

                    //event handler logic
                    inputField.addEventListener("input", (e) => {
                    let brickCount = 0;
                    const canvas = document.getElementById("canvas");
                    const ctx = canvas.getContext("2d");
                    ctx.fillStyle = "#FF3814";
                    ctx.lineWidth = 1;
                    ctx.strokeStyle = "#F5F5DC";
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    e.preventDefault();

                    const widthValue = document.querySelector(".widthField").value * 100;
                    const heightValue = document.querySelector(".heightField").value * 100;

                    canvas.height = heightValue;
                    canvas.width = widthValue;
                    const brickWidth = 25;
                    const brickHeight = 8;
                    brickArea = (brickWidth + 2 * ctx.lineWidth) * (brickHeight + 2 * ctx.lineWidth);
                    wallArea = widthValue * heightValue;
                    brickCountArea = wallArea / brickArea;
                    // console.log(brickCountArea);
                    console.log(`округленно ${Math.round(brickCountArea)}`)
                   
                    //error-handling

                    isNaN(widthValue) || isNaN(heightValue) || widthValue < 0 || heightValue < 0
                        ? (pErrorText.innerText =
                            "Ошибка. Введеное значение не является числом или является числом отрицательным.")
                        : (pErrorText.innerText = "");
                    let x = 0;
                    let y = 10;
                    let k = 0;

                    const fullBrickWidth = brickWidth + ctx.lineWidth*2;
                    const lastBrickWidth = widthValue % fullBrickWidth - ctx.lineWidth * 2;
                    const shortBrickCount = Math.floor(widthValue / fullBrickWidth);
                    console.log(shortBrickCount);

                    for (let i = 1; i <= Math.round(brickCountArea); i++) {
                            ctx.fillStyle = '#cc2b0e';
                            
                            if (x > widthValue) {
                                x = 0;
                                y += brickHeight + 2;
                                ctx.fillRect(x, y, brickWidth/2, brickHeight);
                                ctx.strokeRect(x, y, brickWidth/2, brickHeight);
                                brickCount = 1; 
                            }
                            else {
                                
                                if (brickCount === shortBrickCount) {
                                    ctx.fillRect(x, y, lastBrickWidth, brickHeight);
                                    ctx.strokeRect(x, y, lastBrickWidth, brickHeight);
                                    brickCount += 1;
                                }
                                else {
                                    ctx.fillRect(x, y, brickWidth, brickHeight);
                                    ctx.strokeRect(x, y, brickWidth, brickHeight);
                                    brickCount += 1;
                                      
                                }

                                }
                            x += brickWidth + 2;                           
                        }
                        console.log(brickCount);
    
                    });
                    
                    //clear logic
                    const clearButton = document.querySelector(".сlearButton");
                    clearButton.addEventListener("click", (e) => {
                        e.preventDefault();
                        const canvas = document.getElementById("canvas");
                        const ctx = canvas.getContext("2d");
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        pErrorText.innerText = "";
                    });
                    //suggested values input fields
                    // const redInput = document.querySelector('.redInputField');
                    // redInput.addEventListener('input', () => {
                    //     document.querySelector('.blueInputField').value = redInput.value;
                    // });
                </script>
            </div>
        </div> 
    </body>
</html>